#!/usr/bin/env bash

# Copyright (C) 2015, Arpinum
#
# Beastmaster is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later
# version.
#
# Beastmaster is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along with
# Beastmaster. If not, see http://www.gnu.org/licenses/lgpl.html.

# Beastmaster all in one source file


function bst_config_command__run() {
  echo "config with $@"
}


function bst_free_command__run() {
  echo "free with $@"
}


function bst_list_command__run() {
  echo "list with $@"
}


function bst_order_command__run() {
  echo "order with $@"
}


function bst_tame_command__run() {
  echo "tame with $@"
}


function bst_program__run() {
  (( $# == 0 )) && _bst_program__print_usage_and_exit_normally
  _bst_program__parse_arguments "$@"
}

function _bst_program__parse_arguments() {
  local argument
  for argument in "$@"; do
    case "${argument}" in
      -h|--help)
      _bst_program__print_usage_and_exit_normally
      ;;
      -*|--*)
      _bst_program__print_illegal_option_and_fail "${argument}"
      ;;
      *)
      shift 1
      _bst_program__run_command "${argument}" "$@"
    esac
  done
}

function _bst_program__run_command() {
  local command="$1"
  shift 1
  local command_function="bst_${command}_command__run"
  type "${command_function}" > /dev/null 2>&1 || _bst_program__print_illegal_command_and_fail "${command}"
  ${command_function} "$@"
  exit 0
}

function _bst_program__print_illegal_command_and_fail() {
  echo "bst: illegal command -- $1"
  echo ""
  _bst_program__print_usage
  exit 1
}

function _bst_program__print_usage_and_exit_normally() {
  _bst_program__print_usage
  exit 0
}

function _bst_program__print_illegal_option_and_fail() {
  local option="${1%=*}"
  option="${option#-}"
  option="${option#-}"
  echo "bst: illegal option -- ${option}"
  echo ""
  _bst_program__print_usage
  exit 1
}

function _bst_program__print_usage() {
  echo "\
Usage: bst COMMAND [arg...]

A Bash tool which can run any command in your favorite projects.

Options:
  -h, --help  Print usage

Commands:
  config  Edit the configuration
  free    Remove a project from the project list
  list    Print the project list
  order   Execute a command in the project directory
  tame    Add a project to the project list

Run 'bst COMMAND --help' for more information on a command."
}


[[ "$0" == "${BASH_SOURCE[0]}" ]] && bst_program__run "$@" || true